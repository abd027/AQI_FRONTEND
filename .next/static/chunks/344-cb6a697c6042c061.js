"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[344],{80344:(t,e,a)=>{a.d(e,{$q:()=>l,A$:()=>p,BD:()=>w,CE:()=>h,H0:()=>s,HW:()=>f,Ky:()=>m,X4:()=>g,cC:()=>d,fetchAQIByCoordinates:()=>u,hY:()=>E,ni:()=>j,qH:()=>c,sh:()=>k,xw:()=>y});let n="https://aqi-backend-gohs.onrender.com || http://localhost:8000";function o(){let t=localStorage.getItem("access_token"),e={"Content-Type":"application/json"};return t&&(e.Authorization="Bearer ".concat(t)),e}function r(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login"}async function i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=[300,700],i=o(),c={...e,headers:{...i,...e.headers||{}}};for(let e=0;e<a;e++)try{let o=new AbortController,i=setTimeout(()=>o.abort(),2e4),s=await fetch(t,{...c,signal:o.signal});if(401===s.status)return r(),null;if(clearTimeout(i),s.ok)return s;if(e<a-1){let t=n[e]||n[n.length-1];await new Promise(e=>setTimeout(e,t));continue}return s}catch(t){if(e<a-1&&("AbortError"===t.name||"TypeError"===t.name)){let t=n[e]||n[n.length-1];await new Promise(e=>setTimeout(e,t));continue}if(e===a-1)break}return null}function c(t){var e,a,n,o,r,i;let c=t.current||{};return{city:t.city,aqi:t.aqi,category:t.category,healthAdvice:t.health_advice||t.healthAdvice||"",pollutants:[{name:"PM2.5",value:null!=(e=c.pm2_5)?e:null,unit:"\xb5g/m\xb3"},{name:"PM10",value:null!=(a=c.pm10)?a:null,unit:"\xb5g/m\xb3"},{name:"O₃",value:null!=(n=c.ozone)?n:null,unit:"\xb5g/m\xb3"},{name:"NO₂",value:null!=(o=c.nitrogen_dioxide)?o:null,unit:"\xb5g/m\xb3"},{name:"CO",value:null!=(r=c.carbon_monoxide)?r:null,unit:"\xb5g/m\xb3"},{name:"SO₂",value:null!=(i=c.sulphur_dioxide)?i:null,unit:"\xb5g/m\xb3"}].filter(t=>null!==t.value),weather:t.weather||void 0,lastUpdated:t.lastUpdated||t.last_updated||"",location:t.location,dominant_pollutant:t.dominant_pollutant,dominantPollutant:t.dominant_pollutant,color:t.color,current:c}}async function s(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"New York";try{let e=await i("".concat(n,"/api/aqi/trend?city=").concat(encodeURIComponent(t)),{},3);if(!e||!e.ok)return console.warn("Failed to fetch AQI trend data for ".concat(t,": ").concat((null==e?void 0:e.statusText)||"Unknown error"," (status: ").concat((null==e?void 0:e.status)||"N/A",")")),[];let a=await e.json();return Array.isArray(a)?a:[]}catch(e){return console.error("Error fetching AQI trend for ".concat(t,":"),e),[]}}async function l(){try{let t=await i("".concat(n,"/api/cities/rankings/"),{},3);if(!t||!t.ok)return console.warn("Failed to fetch city rankings"),[];let e=await t.json();if(Array.isArray(e))return e;return e.error&&console.error("Error in city rankings response:",e.detail||e.message),[]}catch(t){return console.error("Error fetching city rankings:",t),[]}}async function u(t,e,a){try{let o=await i("".concat(n,"/api/aqi/coordinates?lat=").concat(t,"&lng=").concat(e),{signal:a});if(!o||!o.ok)return console.warn("Failed to fetch AQI data by coordinates: ".concat((null==o?void 0:o.statusText)||"Unknown error")),null;let r=await o.json();return c(r)}catch(t){return console.error("Error fetching AQI data by coordinates:",t),null}}async function d(t,e,a){try{let o=await i("".concat(n,"/api/aqi/enhanced?lat=").concat(t,"&lng=").concat(e),{signal:a});if(!o||!o.ok)return console.warn("Failed to fetch enhanced AQI data: ".concat((null==o?void 0:o.statusText)||"Unknown error")),null;return await o.json()}catch(t){return console.error("Error fetching enhanced AQI data:",t),null}}async function h(t){try{let e=await i("".concat(n,"/api/aqi/geocode/?city=").concat(encodeURIComponent(t)));if(!e||!e.ok)return null;return await e.json()}catch(t){return console.error("Error geocoding city:",t),null}}async function f(){let t=await fetch("".concat(n,"/api/auth/me"),{headers:o()});if(!t.ok)throw 401===t.status&&r(),Error("Failed to get current user");return await t.json()}async function p(t){let e=await fetch("".concat(n,"/api/auth/verify-email/?token=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=e.headers.get("content-type");if(t&&t.includes("application/json"))try{let t=await e.json();throw Error(t.detail||t.message||"Email verification failed")}catch(t){throw Error("Email verification failed")}else throw Error("Email verification failed: ".concat(e.status," ").concat(e.statusText))}let a=e.headers.get("content-type");a&&a.includes("application/json")&&await e.json()}async function w(t){let e=await fetch("".concat(n,"/api/auth/forgot-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!e.ok)throw Error((await e.json()).detail||"Failed to send password reset email")}async function y(t,e){let a=await fetch("".concat(n,"/api/auth/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,new_password:e})});if(!a.ok)throw Error((await a.json()).detail||"Password reset failed")}async function g(){let t=await fetch("".concat(n,"/api/aqi/subscriptions/"),{headers:{...o(),"Content-Type":"application/json"}});if(!t.ok)throw 401===t.status&&r(),Error((await t.json().catch(()=>({detail:"Failed to fetch subscriptions"}))).detail||"Failed to fetch subscriptions");let e=await t.json();return e&&"object"==typeof e&&"results"in e&&Array.isArray(e.results)?e.results:Array.isArray(e)?e:(console.warn("Unexpected subscriptions response format:",e),[])}async function m(t){let e=await fetch("".concat(n,"/api/aqi/subscriptions/"),{method:"POST",headers:{...o(),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){401===e.status&&r();let t=await e.json().catch(()=>({detail:"Failed to create subscription"}));if(400===e.status&&t.non_field_errors)throw Error(Array.isArray(t.non_field_errors)?t.non_field_errors[0]:t.non_field_errors);if(400===e.status){let e=Object.entries(t).filter(t=>{let[e]=t;return"detail"!==e}).map(t=>{let[e,a]=t,n=Array.isArray(a)?a[0]:a;return"".concat(e,": ").concat(n)});if(e.length>0)throw Error(e.join(", "))}throw Error(t.detail||t.message||"Failed to create subscription")}return await e.json()}async function j(t){let e=await fetch("".concat(n,"/api/aqi/subscriptions/").concat(t,"/"),{method:"DELETE",headers:{...o(),"Content-Type":"application/json"}});if(!e.ok)throw 401===e.status&&r(),Error((await e.json().catch(()=>({detail:"Failed to delete subscription"}))).detail||"Failed to delete subscription")}async function k(t){let e=await fetch("".concat(n,"/api/aqi/subscriptions/").concat(t,"/toggle/"),{method:"PATCH",headers:{...o(),"Content-Type":"application/json"}});if(!e.ok)throw 401===e.status&&r(),Error((await e.json().catch(()=>({detail:"Failed to toggle subscription"}))).detail||"Failed to toggle subscription");return await e.json()}async function E(t,e){let a={};void 0!==e&&(a.aqi_value=e);let i=await fetch("".concat(n,"/api/aqi/subscriptions/").concat(t,"/send_notification/"),{method:"POST",headers:{...o(),"Content-Type":"application/json"},body:Object.keys(a).length>0?JSON.stringify(a):void 0});if(!i.ok){401===i.status&&r();let t="Failed to send notification";try{let e=await i.json();t=e.error||e.detail||t}catch(e){try{let e=await i.text();e&&(t=e)}catch(t){}}throw Error(t)}return await i.json()}}}]);