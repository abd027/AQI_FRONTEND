(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[651],{11647:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(95155);a(12115);var s=a(83101),n=a(64269);let i=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:a}),t),...s})}},13381:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},31824:(e,t,a)=>{Promise.resolve().then(a.bind(a,80582))},36364:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var r=a(95155),s=a(12115),n=a(20063),i=a(62833),l=a(92033);function c(e){let{children:t,requireVerified:a=!1}=e,{user:c,loading:o,isAuthenticated:d}=(0,i.A)(),u=(0,n.useRouter)();return((0,s.useEffect)(()=>{!o&&(d?a&&c&&!c.is_verified&&u.push("/verify-email"):u.push("/login"))},[o,d,c,a,u]),o)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})}):!d||a&&c&&!c.is_verified?null:(0,r.jsx)(r.Fragment,{children:t})}},78108:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var r=a(12115);function s(e){let t=r.useRef({value:e,previous:e});return r.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},80582:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var r=a(95155),s=a(12115),n=a(62833),i=a(20063),l=a(36364),c=a(71349),o=a(86948),d=a(3998),u=a(11647),f=a(92556),h=a(94446),m=a(3468),y=a(23558),p=a(78108),x=a(84288),v=a(88142),g="Switch",[b,j]=(0,m.A)(g),[N,w]=b(g),k=s.forwardRef((e,t)=>{let{__scopeSwitch:a,name:n,checked:i,defaultChecked:l,required:c,disabled:o,value:d="on",onCheckedChange:u,form:m,...p}=e,[x,b]=s.useState(null),j=(0,h.s)(t,e=>b(e)),w=s.useRef(!1),k=!x||m||!!x.closest("form"),[S,A]=(0,y.i)({prop:i,defaultProp:null!=l&&l,onChange:u,caller:g});return(0,r.jsxs)(N,{scope:a,checked:S,disabled:o,children:[(0,r.jsx)(v.sG.button,{type:"button",role:"switch","aria-checked":S,"aria-required":c,"data-state":C(S),"data-disabled":o?"":void 0,disabled:o,value:d,...p,ref:j,onClick:(0,f.mK)(e.onClick,e=>{A(e=>!e),k&&(w.current=e.isPropagationStopped(),w.current||e.stopPropagation())})}),k&&(0,r.jsx)(I,{control:x,bubbles:!w.current,name:n,value:d,checked:S,required:c,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});k.displayName=g;var S="SwitchThumb",A=s.forwardRef((e,t)=>{let{__scopeSwitch:a,...s}=e,n=w(S,a);return(0,r.jsx)(v.sG.span,{"data-state":C(n.checked),"data-disabled":n.disabled?"":void 0,...s,ref:t})});A.displayName=S;var I=s.forwardRef((e,t)=>{let{__scopeSwitch:a,control:n,checked:i,bubbles:l=!0,...c}=e,o=s.useRef(null),d=(0,h.s)(o,t),u=(0,p.Z)(i),f=(0,x.X)(n);return s.useEffect(()=>{let e=o.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==i&&t){let a=new Event("click",{bubbles:l});t.call(e,i),e.dispatchEvent(a)}},[u,i,l]),(0,r.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...c,tabIndex:-1,ref:d,style:{...c.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function C(e){return e?"checked":"unchecked"}I.displayName="SwitchBubbleInput";var E=a(64269);let _=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(k,{className:(0,E.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...s,ref:t,children:(0,r.jsx)(A,{className:(0,E.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});_.displayName=k.displayName;var M=a(10639),F=a(13381),R=a(14294);let P=(0,R.A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var Q=a(94979);function W(e){let{subscription:t,aqiData:a,onToggle:n,onDelete:i,onSendNotification:l,onRefresh:c,loading:f=!1,error:h=null,isLoading:m=!1}=e,[y,p]=(0,s.useState)(!1),[x,v]=(0,s.useState)(!1),g=(null==a?void 0:a.aqi)||0,b=async()=>{if(l){p(!0);try{await l(t.id)}catch(e){console.error("Failed to send notification:",e)}finally{p(!1)}}},j=async()=>{if(c){v(!0);try{await c(t.id)}catch(e){console.error("Failed to refresh AQI data:",e)}finally{v(!1)}}},N=(null==a?void 0:a.color)||(g>0?g<=50?"#00e400":g<=100?"#ffff00":g<=150?"#ff7e00":g<=200?"#ff0000":g<=300?"#8f3f97":"#7e0023":"#808080");return(0,r.jsxs)(o.Zp,{className:"w-full",children:[(0,r.jsx)(o.aR,{children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)(o.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(M.A,{className:"h-4 w-4"}),t.city,", ",t.country]}),(0,r.jsxs)(o.BT,{className:"mt-1",children:[t.latitude.toFixed(4),", ",t.longitude.toFixed(4)]})]}),(0,r.jsx)(u.E,{variant:t.is_active?"default":"secondary",children:t.is_active?"Active":"Inactive"})]})}),(0,r.jsxs)(o.Wu,{children:[m?(0,r.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading AQI data..."})}):h?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"text-sm text-destructive font-medium",children:"Failed to load AQI data"}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:h})]}):a&&null!==a.aqi&&void 0!==a.aqi?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"text-2xl font-bold",style:{color:N},children:Math.round(g)}),c&&(0,r.jsx)(d.$,{variant:"ghost",size:"icon",onClick:j,disabled:f||x||m,className:"h-6 w-6",title:"Refresh AQI data",children:(0,r.jsx)(F.A,{className:"h-3 w-3 ".concat(x?"animate-spin":"")})})]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:a.category||(g<=50?"Good":g<=100?"Moderate":g<=150?"Unhealthy for Sensitive Groups":g<=200?"Unhealthy":g<=300?"Very Unhealthy":"Hazardous")})]}),(0,r.jsx)("div",{className:"w-16 h-16 rounded-full ".concat(g<=50?"bg-green-500":g<=100?"bg-yellow-500":g<=150?"bg-orange-500":g<=200?"bg-red-500":g<=300?"bg-purple-500":"bg-red-800"," opacity-20")})]}),a.dominant_pollutant&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Dominant Pollutant: "}),(0,r.jsx)("span",{className:"font-medium",children:a.dominant_pollutant})]}),a.lastUpdated&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Last updated: ",new Date(a.lastUpdated).toLocaleString()]})]}):(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"No AQI data available"}),(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(_,{checked:t.is_active,onCheckedChange:()=>n(t.id),disabled:f}),(0,r.jsxs)("label",{className:"text-sm font-medium",children:["Email notifications ",t.is_active?"enabled":"disabled"]})]}),(0,r.jsx)(d.$,{variant:"ghost",size:"icon",onClick:()=>i(t.id),disabled:f,children:(0,r.jsx)(P,{className:"h-4 w-4"})})]}),l&&(0,r.jsxs)(d.$,{variant:"outline",size:"sm",onClick:b,disabled:f||y,className:"w-full",children:[(0,r.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),y?"Sending...":"Send Notification"]})]})]})]})}function T(e){let{subscriptions:t,aqiDataMap:a,onToggle:s,onDelete:n,onSendNotification:i,onRefresh:l,loading:c=!1,loadingStates:o={},errorStates:d={}}=e,u=Array.isArray(t)?t:[];return 0===u.length?(0,r.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,r.jsx)("p",{children:"No subscriptions yet."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Add a city subscription to receive email alerts when AQI exceeds 100."})]}):(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:u.map(e=>{let t=function(e,t){let a=(t||"unknown").trim();return"".concat(e,"_").concat(a).toLowerCase()}(e.city,e.country),u=a[t],f=o[t]||!1,h=d[t]||null;return(0,r.jsx)(W,{subscription:e,aqiData:u,onToggle:s,onDelete:n,onSendNotification:i,onRefresh:l,loading:c,isLoading:f,error:h},e.id)})})}var q=a(53440),O=a(92689),D=a(92033);let L=(0,R.A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function z(e){let{onSubmit:t,loading:a=!1}=e,[n,i]=(0,s.useState)(""),[l,c]=(0,s.useState)(""),[u,f]=(0,s.useState)(void 0),[h,m]=(0,s.useState)(""),y=async e=>{if(e.preventDefault(),m(""),!n||!l)return void m("Please select both city and country");if(!u)return void m("Please select a valid city with coordinates");let{lat:a,lng:r}=u;if(a<-90||a>90)return void m("Invalid latitude. Must be between -90 and 90.");if(r<-180||r>180)return void m("Invalid longitude. Must be between -180 and 180.");try{await t({city:n.trim(),country:l.trim(),latitude:a,longitude:r}),i(""),c(""),f(void 0),m("")}catch(t){let e="Failed to add subscription";t.message?e=t.message:"string"==typeof t?e=t:t.detail?e=t.detail:t.non_field_errors&&Array.isArray(t.non_field_errors)&&(e=t.non_field_errors[0]),m(e)}};return(0,r.jsxs)(o.Zp,{children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsx)(o.ZB,{children:"Add City Subscription"}),(0,r.jsx)(o.BT,{children:"Subscribe to receive email notifications when AQI exceeds 100 in this city"})]}),(0,r.jsx)(o.Wu,{children:(0,r.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,r.jsx)(q.A,{value:n,onChange:(e,t,a)=>{i(e),t&&c(t),a&&f(a)},disabled:a,placeholder:"Search for a city...",label:"City"}),(0,r.jsx)(O.A,{value:l,onChange:e=>{c(e)},disabled:a,placeholder:"Select or search for a country...",label:"Country"}),h&&(0,r.jsx)("div",{className:"text-sm text-destructive",children:h}),(0,r.jsx)(d.$,{type:"submit",disabled:a||!n||!l||!u,className:"w-full mt-4",variant:"default",size:"default",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L,{className:"mr-2 h-4 w-4"}),"Add Subscription"]})})]})})]})}var Z=a(80344);let G="https://aqi-backend-gohs.onrender.com || http://localhost:8000".replace("http://","ws://").replace("https://","wss://");var U=a(18332);let B=(0,R.A)("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),H=(0,R.A)("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var J=a(78770);function V(e,t){let a=(t||"unknown").trim();return"".concat(e,"_").concat(a).toLowerCase()}function $(){let{user:e}=(0,n.A)();(0,i.useRouter)();let[t,d]=(0,s.useState)([]),[u,f]=(0,s.useState)({}),[h,m]=(0,s.useState)(!0),[y,p]=(0,s.useState)(null),[x,v]=(0,s.useState)(!1),[g,b]=(0,s.useState)({}),[j,N]=(0,s.useState)({}),w=(0,s.useRef)([]),{isConnected:k,subscribe:S,unsubscribe:A}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoConnect:t=!0,onUpdate:a,onError:r}=e,{user:i}=(0,n.A)(),[l,c]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),u=(0,s.useRef)(null),f=(0,s.useRef)(null),h=(0,s.useRef)(0),m=(0,s.useRef)(!1),y=(0,s.useRef)(a),p=(0,s.useRef)(r),x=(0,s.useRef)({});(0,s.useEffect)(()=>{y.current=a,p.current=r},[a,r]);let v=(0,s.useCallback)(async()=>{if(!m.current&&i){if(u.current){let e=u.current.readyState;if(e===WebSocket.OPEN||e===WebSocket.CONNECTING)return;(e===WebSocket.CLOSING||e===WebSocket.CLOSED)&&(u.current=null)}m.current=!0;try{let e=localStorage.getItem("access_token");if(!e){d("Authentication required"),m.current=!1;return}let t="".concat(G,"/ws/aqi/live/?token=").concat(e),a=new WebSocket(t);a.onopen=()=>{m.current=!1,c(!0),d(null),h.current=0,console.log("WebSocket connected");let e=Object.values(x.current);e.length>0&&e.forEach(e=>{a.send(JSON.stringify({type:"subscribe",city:e.city,country:e.country,lat:e.lat,lon:e.lon}))})},a.onmessage=e=>{try{let t=JSON.parse(e.data);if("pong"===t.type)return;y.current&&y.current(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},a.onerror=e=>{m.current=!1,console.error("WebSocket error:",e),d("WebSocket connection error"),p.current&&p.current(e)},a.onclose=e=>{m.current=!1,c(!1),console.log("WebSocket disconnected",e.code,e.reason),1e3!==e.code&&4001!==e.code&&i&&(h.current<5?(h.current++,f.current=setTimeout(()=>{v()},3e3)):d("Failed to reconnect. Please refresh the page."))},u.current=a}catch(e){m.current=!1,console.error("Error connecting WebSocket:",e),d("Failed to connect to WebSocket")}}},[i]),g=(0,s.useCallback)(()=>{f.current&&(clearTimeout(f.current),f.current=null),u.current&&(u.current.close(1e3,"Manual disconnect"),u.current=null),m.current=!1,c(!1),h.current=0},[]),b=(0,s.useCallback)((e,t,a,r)=>{var s;let n="".concat(e,"_").concat(t).toLowerCase();return x.current[n]={city:e,country:t,lat:a,lon:r},(null==(s=u.current)?void 0:s.readyState)===WebSocket.OPEN&&(u.current.send(JSON.stringify({type:"subscribe",city:e,country:t,lat:a,lon:r})),!0)},[]),j=(0,s.useCallback)((e,t)=>{var a;let r="".concat(e,"_").concat(t).toLowerCase();delete x.current[r],(null==(a=u.current)?void 0:a.readyState)===WebSocket.OPEN&&u.current.send(JSON.stringify({type:"unsubscribe",city:e,country:t}))},[]),N=(0,s.useCallback)(()=>{var e;(null==(e=u.current)?void 0:e.readyState)===WebSocket.OPEN&&u.current.send(JSON.stringify({type:"ping"}))},[]);return(0,s.useEffect)(()=>{if(t&&i){let e=setTimeout(()=>{v()},200);return()=>{clearTimeout(e),g()}}return()=>{g()}},[t,i]),{isConnected:l,error:o,connect:v,disconnect:g,subscribe:b,unsubscribe:j,sendPing:N}}({autoConnect:!0,onUpdate:e=>{if("aqi_update"===e.type&&e.city&&e.data){let t=V(e.city,e.country);try{let a=(0,Z.qH)(e.data);f(e=>({...e,[t]:a})),N(e=>({...e,[t]:null}))}catch(a){console.error("Error transforming WebSocket AQI data:",a),f(a=>({...a,[t]:e.data}))}}}}),I=(0,s.useCallback)(async()=>{try{m(!0),p(null);let e=await (0,Z.X4)();d(e);let{fetchAQIByCoordinates:t}=await Promise.resolve().then(a.bind(a,80344)),r=e.filter(e=>e.is_active),s=[];for(let e=0;e<r.length;e++){let a=r[e],n=V(a.city,a.country);b(e=>({...e,[n]:!0})),N(e=>({...e,[n]:null}));try{e>0&&await new Promise(e=>setTimeout(e,600));let r=await t(a.latitude,a.longitude);r?s.push({cityKey:n,aqiData:r}):(N(e=>({...e,[n]:"No AQI data available for this location"})),s.push(null))}catch(t){let e=(null==t?void 0:t.message)||"Failed to fetch AQI data for ".concat(a.city);console.warn("Failed to fetch initial AQI for ".concat(a.city,":"),t),N(t=>({...t,[n]:e})),s.push(null)}finally{b(e=>({...e,[n]:!1}))}}let n={};s.forEach(e=>{e&&(n[e.cityKey]=e.aqiData)}),f(e=>({...e,...n}));let i=()=>{k&&e.forEach(e=>{e.is_active&&S(e.city,e.country,e.latitude,e.longitude)})};if(k)i();else{let e=Date.now(),t=setInterval(()=>{(k||Date.now()-e>3e3)&&(clearInterval(t),k&&i())},100)}}catch(e){p(e.message||"Failed to load subscriptions")}finally{m(!1)}},[S,k]);(0,s.useEffect)(()=>{e&&I()},[e,I]),(0,s.useEffect)(()=>{w.current=t},[t]);let C=(0,s.useCallback)(async e=>{let{fetchAQIByCoordinates:t}=await Promise.resolve().then(a.bind(a,80344)),r=w.current;if(void 0!==e){let a=r.find(t=>t.id===e);if(!a||!a.is_active)return;let s=V(a.city,a.country);b(e=>({...e,[s]:!0})),N(e=>({...e,[s]:null}));try{let e=await t(a.latitude,a.longitude);e?(f(t=>({...t,[s]:e})),N(e=>({...e,[s]:null}))):N(e=>({...e,[s]:"No AQI data available for this location"}))}catch(t){let e=(null==t?void 0:t.message)||"Failed to fetch AQI data for ".concat(a.city);N(t=>({...t,[s]:e}))}finally{b(e=>({...e,[s]:!1}))}return}let s=r.filter(e=>e.is_active);if(0!==s.length)for(let e=0;e<s.length;e++){let a=s[e],r=V(a.city,a.country);try{e>0&&await new Promise(e=>setTimeout(e,300));let s=await t(a.latitude,a.longitude);s&&(f(e=>({...e,[r]:s})),N(e=>({...e,[r]:null})))}catch(e){console.warn("Failed to refresh AQI for ".concat(a.city,":"),e)}}},[]);(0,s.useEffect)(()=>{if(!e||0===t.length)return;let a=!0,r=setTimeout(()=>{a&&C()},25e3),s=setInterval(()=>{a&&C()},25e3);return()=>{a=!1,clearTimeout(r),clearInterval(s)}},[e,t.length,C]);let E=async e=>{try{v(!0),p(null);let t=await (0,Z.Ky)(e);d(e=>[...e,t]);let{fetchAQIByCoordinates:r}=await Promise.resolve().then(a.bind(a,80344)),s=V(e.city,e.country);b(e=>({...e,[s]:!0})),N(e=>({...e,[s]:null}));try{let t=await r(e.latitude,e.longitude);t?f(e=>({...e,[s]:t})):N(e=>({...e,[s]:"No AQI data available for this location"}))}catch(t){let e=(null==t?void 0:t.message)||"Failed to fetch AQI data";console.warn("Failed to fetch initial AQI data:",t),N(t=>({...t,[s]:e}))}finally{b(e=>({...e,[s]:!1}))}k&&S(e.city,e.country,e.latitude,e.longitude)}catch(e){throw p(e.message||"Failed to add subscription"),e}finally{v(!1)}},_=async e=>{try{v(!0);let a=await (0,Z.sh)(e);d(t=>t.map(t=>t.id===e?a:t));let r=t.find(t=>t.id===e);r&&(a.is_active?S(r.city,r.country,r.latitude,r.longitude):A(r.city,r.country))}catch(e){p(e.message||"Failed to toggle subscription")}finally{v(!1)}},M=async e=>{if(confirm("Are you sure you want to remove this subscription?"))try{v(!0);let a=t.find(t=>t.id===e);if(await (0,Z.ni)(e),d(t=>t.filter(t=>t.id!==e)),a){A(a.city,a.country);let e=V(a.city,a.country);f(t=>{let a={...t};return delete a[e],a}),b(t=>{let a={...t};return delete a[e],a}),N(t=>{let a={...t};return delete a[e],a})}}catch(e){p(e.message||"Failed to delete subscription")}finally{v(!1)}},F=async e=>{try{let a;p(null);let r=t.find(t=>t.id===e);if(r){let e=u[V(r.city,r.country)];if(e&&null!==e.aqi&&void 0!==e.aqi&&e.aqi>0)a=Math.round(e.aqi);else throw Error("No valid AQI data available for this location. Please refresh the data first.")}else throw Error("Subscription not found.");if(void 0===a||a<=0)throw Error("Invalid AQI value. Please refresh the data and try again.");let s=await (0,Z.hY)(e,a);alert(s.message||"Notification sent successfully!")}catch(e){throw p(e.message||"Failed to send notification"),e}};return(0,r.jsx)(l.A,{children:(0,r.jsx)(c.A,{children:(0,r.jsxs)("div",{className:"flex flex-col gap-4 md:gap-6 p-4 md:p-6 lg:p-8",children:[(0,r.jsxs)("header",{className:"animate-slide-up flex-shrink-0",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight mb-2",children:"City Subscriptions"}),(0,r.jsx)("p",{className:"text-muted-foreground text-sm md:text-base",children:"Manage your city subscriptions to receive email alerts when AQI exceeds 100"})]}),(0,r.jsx)("div",{className:"mb-4 md:mb-6 animate-slide-up",style:{animationDelay:"0.05s"},children:(0,r.jsx)(U.Fc,{children:k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B,{className:"h-4 w-4"}),(0,r.jsx)(U.TN,{children:"Live updates enabled. AQI data will refresh automatically."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H,{className:"h-4 w-4"}),(0,r.jsx)(U.TN,{children:"Live updates disabled. Please refresh the page to see latest AQI data."})]})})}),y&&(0,r.jsxs)(U.Fc,{variant:"destructive",className:"mb-4 md:mb-6 animate-slide-up",style:{animationDelay:"0.05s"},children:[(0,r.jsx)(J.A,{className:"h-4 w-4"}),(0,r.jsx)(U.TN,{children:y})]}),(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3 animate-slide-up",style:{animationDelay:"0.1s"},children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsx)(z,{onSubmit:E,loading:x})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:h?(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"flex items-center justify-center py-12",children:(0,r.jsx)(D.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):(0,r.jsx)(T,{subscriptions:t,aqiDataMap:u,onToggle:_,onDelete:M,onSendNotification:F,onRefresh:C,loading:x,loadingStates:g,errorStates:j})})]})]})})})}},94979:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(14294).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])}},e=>{e.O(0,[286,619,314,470,344,349,283,441,493,358],()=>e(e.s=31824)),_N_E=e.O()}]);